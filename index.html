<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œì•„ì„±ì¥ AI ì±—ë´‡ - ê°œì„  ë²„ì „</title>
    <style>
        /* ê¸°ì¡´ ë””ìì¸ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh; display: flex; justify-content: center; align-items: center;
        }
        .chatbot-container {
            width: 90%; max-width: 500px; height: 90vh; max-height: 700px;
            background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; overflow: hidden;
        }
        .chat-header {
            background: linear-gradient(135deg, #00B050 0%, #00d561 100%);
            color: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chat-header h1 { font-size: 20px; margin-bottom: 5px; }
        .version-badge { 
            background: rgba(255,255,255,0.2); 
            padding: 4px 12px; border-radius: 12px; font-size: 11px; display: inline-block; margin-top: 5px;
        }
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; background: #f8f9fa; }
        .message { margin-bottom: 15px; display: flex; flex-direction: column; }
        .user-message { align-items: flex-end; }
        .bot-message { align-items: flex-start; }
        .message-bubble {
            max-width: 80%; padding: 12px 16px; border-radius: 18px;
            word-wrap: break-word; line-height: 1.5; white-space: pre-wrap;
        }
        .user-message .message-bubble { background: #007bff; color: white; border-bottom-right-radius: 4px; }
        .bot-message .message-bubble { background: white; color: #333; border-bottom-left-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .video-button {
            display: inline-block; margin-top: 10px; padding: 10px 20px;
            background: #FF0000; color: white; text-decoration: none;
            border-radius: 20px; font-size: 14px; transition: background 0.3s;
        }
        .chat-input-container { padding: 15px; background: white; border-top: 1px solid #e0e0e0; display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 25px; outline: none; }
        .chat-input:focus { border-color: #00B050; }
        .send-button { padding: 12px 24px; background: #00B050; color: white; border: none; border-radius: 25px; cursor: pointer; }
        .loading { display: none; text-align: center; padding: 10px; color: #666; font-size: 13px; }
        .loading.show { display: block; }
    </style>
</head>
<body>
<div class="chatbot-container">
    <div class="chat-header">
        <h1>ğŸ¥ ì†Œì•„ì„±ì¥ AI ì±—ë´‡</h1>
        <p>ì„±ì¥í˜¸ë¥´ëª¬ãƒ»ì„±ì¡°ìˆ™ì¦ ì „ë¬¸</p>
        <div class="version-badge">âœ¨ ë§¤í•‘ ìµœì í™” ë²„ì „ v3.0</div>
    </div>
    <div class="chat-messages" id="messages">
        </div>
    <div class="loading" id="loading">ë‹µë³€ì„ ì°¾ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    <div class="chat-input-container">
        <input type="text" class="chat-input" id="userInput" placeholder="ë¹„íƒ€ë¯¼, ì„±ì¡°ìˆ™ì¦ ë“± ê¶ê¸ˆí•œ ì ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button class="send-button" onclick="sendMessage()">ì „ì†¡</button>
    </div>
</div>

<script>
let allRecords = [];

// 1. ë°ì´í„° ë¡œë“œ (Airtableì—ì„œ ì¶”ì¶œí•œ chatbot_data.json í™œìš©)
window.addEventListener('load', async function() {
    try {
        const response = await fetch('chatbot_data.json');
        if (!response.ok) throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        allRecords = await response.json();
        addMessage("ì•ˆë…•í•˜ì„¸ìš”! ì†Œì•„ ì„±ì¥ê³¼ ì„±ì¡°ìˆ™ì¦ì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”. ğŸ˜Š", 'bot');
    } catch (error) {
        console.error('Error:', error);
        addMessage("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ëª…ì„ í™•ì¸í•´ì£¼ì„¸ìš”.", 'bot');
    }
});

// 2. ë©”ì‹œì§€ ì „ì†¡ ë¡œì§
async function sendMessage() {
    const input = document.getElementById('userInput');
    const question = input.value.trim();
    if (!question || allRecords.length === 0) return;

    addMessage(question, 'user');
    input.value = '';
    document.getElementById('loading').classList.add('show');

    // 0.5ì´ˆ í›„ ë‹µë³€ ìƒì„± (ìì—°ìŠ¤ëŸ¬ìš´ ì—°ì¶œ)
    setTimeout(() => {
        const result = findBestMatch(question);
        document.getElementById('loading').classList.remove('show');

        if (result) {
            addMessage(result.answer, 'bot', result.videoLink);
        } else {
            addMessage("ì£„ì†¡í•©ë‹ˆë‹¤. ì •í™•í•œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n'ë¹„íƒ€ë¯¼', 'ì„±ì¡°ìˆ™ì¦ ê²€ì‚¬', 'ì„±ì¥í˜¸ë¥´ëª¬ ì£¼ì‚¬' ë“± í•µì‹¬ ë‹¨ì–´ë¡œ ì§ˆë¬¸í•´ë³´ì‹œê² ì–´ìš”?", 'bot');
        }
    }, 500);
}

// 3. í•µì‹¬ ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜ (Airtable í•„ë“œ ê¸°ë°˜ ë§¤í•‘)
function findBestMatch(userInput) {
    const cleanInput = userInput.toLowerCase().replace(/\s/g, ""); 
    let bestMatch = null;
    let maxScore = 0;

    allRecords.forEach(record => {
        let score = 0;
        
        // ê°€ì¤‘ì¹˜ 1: ì§ˆë¬¸ í•„ë“œì™€ í¬í•¨ ê´€ê³„ (60ì )
        const dbQuestion = record.ì§ˆë¬¸.toLowerCase().replace(/\s/g, "");
        if (cleanInput.includes(dbQuestion) || dbQuestion.includes(cleanInput)) {
            score += 60;
        }

        // ê°€ì¤‘ì¹˜ 2: í‚¤ì›Œë“œ í•„ë“œ ë§¤ì¹­ (ê°œë‹¹ 20ì )
        if (record.í‚¤ì›Œë“œ) {
            const keywords = record.í‚¤ì›Œë“œ.split(",").map(k => k.trim().toLowerCase());
            keywords.forEach(kw => {
                if (kw && cleanInput.includes(kw)) {
                    score += 20;
                }
            });
        }

        // ê°€ì¤‘ì¹˜ 3: íƒœê·¸ í•„ë“œ ë§¤ì¹­ (ê°œë‹¹ 10ì )
        if (record.íƒœê·¸) {
            const tags = record.íƒœê·¸.split("#").map(t => t.trim().toLowerCase());
            tags.forEach(tag => {
                if (tag && cleanInput.includes(tag)) {
                    score += 10;
                }
            });
        }

        if (score > maxScore) {
            maxScore = score;
            bestMatch = record;
        }
    });

    // ìµœì†Œ 20ì  ì´ìƒì¼ ë•Œë§Œ ë‹µë³€ (ë„ˆë¬´ ë¬´ê´€í•œ ë‹µë³€ ë°©ì§€)
    return maxScore >= 20 ? {
        answer: bestMatch.ë‹µë³€,
        videoLink: bestMatch.ì˜ìƒë§í¬
    } : null;
}

function addMessage(text, type, videoLink = null) {
    const messages = document.getElementById('messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}-message`;
    
    const bubble = document.createElement('div');
    bubble.className = 'message-bubble';
    bubble.textContent = text;
    
    messageDiv.appendChild(bubble);

    if (videoLink && videoLink !== 'nan' && videoLink.startsWith('http')) {
        const videoBtn = document.createElement('a');
        videoBtn.className = 'video-button';
        videoBtn.href = videoLink;
        videoBtn.target = '_blank';
        videoBtn.innerHTML = 'ğŸ“º ê´€ë ¨ ì˜ìƒ ë³´ê¸°';
        bubble.appendChild(document.createElement('br'));
        bubble.appendChild(videoBtn);
    }

    messages.appendChild(messageDiv);
    messages.scrollTop = messages.scrollHeight;
}
</script>
</body>
</html>
