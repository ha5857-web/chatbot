<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œì•„ì„±ì¥ AI ì±—ë´‡</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh; display: flex; justify-content: center; align-items: center;
        }
        .chatbot-container {
            width: 90%; max-width: 500px; height: 90vh; max-height: 700px;
            background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; overflow: hidden;
        }
        .chat-header {
            background: linear-gradient(135deg, #00B050 0%, #00d561 100%);
            color: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chat-header h1 { font-size: 20px; margin-bottom: 5px; }
        .chat-header p { font-size: 12px; opacity: 0.9; }
        .version-badge { 
            background: rgba(255,255,255,0.2); 
            padding: 4px 12px; 
            border-radius: 12px; 
            font-size: 11px; 
            display: inline-block; 
            margin-top: 5px;
        }
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; background: #f8f9fa; }
        .message { margin-bottom: 15px; display: flex; flex-direction: column; }
        .user-message { align-items: flex-end; }
        .bot-message { align-items: flex-start; }
        .message-bubble {
            max-width: 80%; padding: 12px 16px; border-radius: 18px;
            word-wrap: break-word; line-height: 1.5;
        }
        .user-message .message-bubble {
            background: #007bff; color: white; border-bottom-right-radius: 4px;
        }
        .bot-message .message-bubble {
            background: white; color: #333; border-bottom-left-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .video-button {
            display: inline-block; margin-top: 10px; padding: 10px 20px;
            background: #FF0000; color: white; text-decoration: none;
            border-radius: 20px; font-size: 14px; transition: background 0.3s;
        }
        .video-button:hover { background: #cc0000; }
        .chat-input-container {
            padding: 15px; background: white; border-top: 1px solid #e0e0e0;
            display: flex; gap: 10px;
        }
        .chat-input {
            flex: 1; padding: 12px 16px; border: 2px solid #e0e0e0;
            border-radius: 25px; font-size: 14px; outline: none; transition: border 0.3s;
        }
        .chat-input:focus { border-color: #00B050; }
        .send-button {
            padding: 12px 24px; background: #00B050; color: white; border: none;
            border-radius: 25px; font-size: 14px; cursor: pointer; transition: background 0.3s;
        }
        .send-button:hover { background: #009040; }
        .send-button:active { transform: scale(0.95); }
        .loading { display: none; text-align: center; padding: 10px; color: #666; }
        .loading.show { display: block; }
        .welcome-message { text-align: center; padding: 40px 20px; color: #666; }
        .welcome-message h2 { color: #00B050; margin-bottom: 10px; }
        .example-questions { margin-top: 20px; text-align: left; }
        .example-questions h3 { font-size: 14px; color: #666; margin-bottom: 10px; }
        .example-question {
            background: white; padding: 10px 15px; margin: 8px 0; border-radius: 10px;
            cursor: pointer; font-size: 13px; color: #333; transition: background 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .example-question:hover { background: #f0f0f0; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>
<div class="chatbot-container">
    <div class="chat-header">
        <h1>ğŸ¥ ì†Œì•„ì„±ì¥ AI ì±—ë´‡</h1>
        <p>ì„±ì¥í˜¸ë¥´ëª¬ãƒ»ì„±ì¡°ìˆ™ì¦ãƒ»ì†Œì•„ë¹„ë§Œ ì „ë¬¸</p>
        <div class="version-badge">âœ¨ ê°œì„  ë²„ì „ v2.0 (100+ íŒ¨í„´)</div>
    </div>
    <div class="chat-messages" id="messages">
        <div class="welcome-message">
            <h2>ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</h2>
            <p>ì†Œì•„ ì„±ì¥ê³¼ ë¹„ë§Œì— ëŒ€í•´<br>ê¶ê¸ˆí•œ ì ì„ ì§ˆë¬¸í•´ì£¼ì„¸ìš”!</p>
            <div class="example-questions">
                <h3>ğŸ’¡ ì´ëŸ° ì§ˆë¬¸ì„ í•´ë³´ì„¸ìš”:</h3>
                <div class="example-question" onclick="sendExampleQuestion('ì„±ì¥í˜¸ë¥´ëª¬ì€ ì–¸ì œ ë‚˜ì˜¤ë‚˜ìš”?')">
                    ì„±ì¥í˜¸ë¥´ëª¬ì€ ì–¸ì œ ë‚˜ì˜¤ë‚˜ìš”?
                </div>
                <div class="example-question" onclick="sendExampleQuestion('ì•„ì´ê°€ 8ì„¼í‹°ë¯¸í„°ë‚˜ ìëì–´ìš”')">
                    ì•„ì´ê°€ 8ì„¼í‹°ë¯¸í„°ë‚˜ ìëì–´ìš”
                </div>
                <div class="example-question" onclick="sendExampleQuestion('ê°€ìŠ´ì— ë©ìš¸ì´ ìƒê²¼ì–´ìš”')">
                    ê°€ìŠ´ì— ë©ìš¸ì´ ìƒê²¼ì–´ìš”
                </div>
                <div class="example-question" onclick="sendExampleQuestion('ì‚´ì´ ë§ì´ ìª˜ëŠ”ë° ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?')">
                    ì‚´ì´ ë§ì´ ìª˜ëŠ”ë° ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?
                </div>
            </div>
        </div>
    </div>
    <div class="loading" id="loading">ë‹µë³€ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</div>
    <div class="chat-input-container">
        <input type="text" class="chat-input" id="userInput" placeholder="ê¶ê¸ˆí•œ ì ì„ ììœ ë¡­ê²Œ ì§ˆë¬¸í•˜ì„¸ìš”..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button class="send-button" onclick="sendMessage()">ì „ì†¡</button>
    </div>
</div>
<script>
let allRecords = [];
let isFirstMessage = true;

window.addEventListener('load', async function() {
    console.log('ë°ì´í„° ë¡œë”© ì‹œì‘...');
    try {
        const response = await fetch('chatbot_data.json');
        if (!response.ok) throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        allRecords = await response.json();
        console.log(`âœ“ ${allRecords.length}ê°œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ`);
    } catch (error) {
        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
});

function sendExampleQuestion(question) {
    document.getElementById('userInput').value = question;
    sendMessage();
}

async function sendMessage() {
    const input = document.getElementById('userInput');
    const question = input.value.trim();
    if (!question) return;
    if (allRecords.length === 0) {
        alert('ë°ì´í„°ë¥¼ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
    }
    if (isFirstMessage) {
        const welcome = document.querySelector('.welcome-message');
        if (welcome) welcome.remove();
        isFirstMessage = false;
    }
    addMessage(question, 'user');
    input.value = '';
    document.getElementById('loading').classList.add('show');
    const result = findAnswer(question);
    document.getElementById('loading').classList.remove('show');
    if (result) {
        addMessage(result.answer, 'bot', result.videoLink);
    } else {
        const suggestions = findSimilarQuestions(question);
        let message = 'ì£„ì†¡í•©ë‹ˆë‹¤. ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n';
        if (suggestions.length > 0) {
            message += 'í˜¹ì‹œ ì´ëŸ° ì§ˆë¬¸ì„ ì°¾ìœ¼ì‹œë‚˜ìš”?\n\n';
            suggestions.forEach((q, idx) => {
                message += `${idx + 1}. ${q}\n`;
            });
            message += '\nìœ„ ì§ˆë¬¸ ì¤‘ í•˜ë‚˜ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”!';
        } else {
            message += 'ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì§ˆë¬¸í•´ë³´ì‹œê±°ë‚˜, ë” êµ¬ì²´ì ìœ¼ë¡œ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.';
        }
        addMessage(message, 'bot');
    }
}

function findSimilarQuestions(question) {
    const lowerQuestion = question.toLowerCase();
    const suggestions = [];
    const keywords = ['ì„±ì¡°ìˆ™ì¦', 'ì„±ì¥í˜¸ë¥´ëª¬', 'ì†Œì•„ë¹„ë§Œ', 'í‚¤', 'ì €ì‹ ì¥', 'ë¹„ë§Œ'];
    let mainKeyword = '';
    for (const keyword of keywords) {
        if (lowerQuestion.includes(keyword)) {
            mainKeyword = keyword;
            break;
        }
    }
    if (mainKeyword) {
        for (const record of allRecords) {
            if (record.ì§ˆë¬¸.includes(mainKeyword) && suggestions.length < 3) {
                suggestions.push(record.ì§ˆë¬¸);
            }
        }
    }
    return suggestions;
}

function findExactMatch(targetQuestion) {
    for (const record of allRecords) {
        if (record.ì§ˆë¬¸ === targetQuestion) {
            return {
                answer: record.ë‹µë³€ || 'ë‹µë³€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.',
                videoLink: record.ì˜ìƒë§í¬,
                question: record.ì§ˆë¬¸
            };
        }
    }
    return null;
}

function findAnswer(question) {
    const lowerQuestion = question.toLowerCase();
    const cleanQuestion = lowerQuestion.replace(/\s/g, '');
    
    // 100+ ì§ì ‘ ë§¤í•‘ íŒ¨í„´
    const questionMappings = {
        // ì„±ì¥ ì†ë„ ê´€ë ¨ (ìˆ«ì 5-15)
        '5ì„¼í‹°': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '5cm': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '5ì„¼ì¹˜': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '6ì„¼í‹°': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '6cm': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '6ì„¼ì¹˜': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '7ì„¼í‹°': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '7cm': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '7ì„¼ì¹˜': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '8ì„¼í‹°': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '8cm': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '8ì„¼ì¹˜': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '9ì„¼í‹°': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '9cm': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '10ì„¼í‹°': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '10cm': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '11ì„¼í‹°': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '11cm': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '12ì„¼í‹°': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '12cm': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '15ì„¼í‹°': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '15cm': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        '1ë…„ì—ëª‡': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        'ì–¼ë§ˆë‚˜ì»¤': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        'ì„±ì¥ì†ë„': 'ìš°ë¦¬ ì•„ì´ ì„±ì¥ ì†ë„, ì–´ë–»ê²Œ í™•ì¸í•˜ë‚˜ìš”?',
        'ê¸‰ì„±ì¥': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        'ë§ì´ì»¸': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        'ë§ì´ìëŒ': 'ì•„ì´ê°€ 1ë…„ì— ì–¼ë§ˆë‚˜ ì»¤ì•¼ ì •ìƒì¸ê°€ìš”?',
        
        // ì„±ì¡°ìˆ™ì¦ ê´€ë ¨
        'ê°€ìŠ´ë©ìš¸': 'ë§Œ ë‘ ì‚´ì¸ë° ê°€ìŠ´ì— ë©ìš¸ì´ ì¡í˜”ì–´ìš”. ì„±ì¡°ìˆ™ì¦ì¸ê°€ìš”?',
        'ê°€ìŠ´ëª½ìš°ë¦¬': 'ë§Œ ë‘ ì‚´ì¸ë° ê°€ìŠ´ì— ë©ìš¸ì´ ì¡í˜”ì–´ìš”. ì„±ì¡°ìˆ™ì¦ì¸ê°€ìš”?',
        'ìœ ë°©ë°œë‹¬': 'ë§Œ ë‘ ì‚´ì¸ë° ê°€ìŠ´ì— ë©ìš¸ì´ ì¡í˜”ì–´ìš”. ì„±ì¡°ìˆ™ì¦ì¸ê°€ìš”?',
        'ê°€ìŠ´ë§Œì ¸': 'ë§Œ ë‘ ì‚´ì¸ë° ê°€ìŠ´ì— ë©ìš¸ì´ ì¡í˜”ì–´ìš”. ì„±ì¡°ìˆ™ì¦ì¸ê°€ìš”?',
        'ê°€ìŠ´ì»¤ì§': 'ë§Œ ë‘ ì‚´ì¸ë° ê°€ìŠ´ì— ë©ìš¸ì´ ì¡í˜”ì–´ìš”. ì„±ì¡°ìˆ™ì¦ì¸ê°€ìš”?',
        '2ì°¨ì„±ì§•': 'ì¡°ê¸° ìœ ë°© ë°œìœ¡ì¦ê³¼ ì„±ì¡°ìˆ™ì¦ì€ ì–´ë–»ê²Œ êµ¬ë³„í•˜ë‚˜ìš”?',
        'ì‚¬ì¶˜ê¸°ë¹¨ë¦¬': 'ì¡°ê¸° ìœ ë°© ë°œìœ¡ì¦ê³¼ ì„±ì¡°ìˆ™ì¦ì€ ì–´ë–»ê²Œ êµ¬ë³„í•˜ë‚˜ìš”?',
        'ì„±ì¡°ìˆ™ì¦ì¦ìƒ': 'ì¡°ê¸° ìœ ë°© ë°œìœ¡ì¦ê³¼ ì„±ì¡°ìˆ™ì¦ì€ ì–´ë–»ê²Œ êµ¬ë³„í•˜ë‚˜ìš”?',
        'ì„±ì¡°ìˆ™ì¦ì¹˜ë£Œ': 'ì„±ì¡°ìˆ™ì¦ ì§„ë‹¨ì„ ë°›ì•˜ëŠ”ë°, ì§€ì—”ì•Œì—ì´ì¹˜ ì•„ë‚ ë¡œê·¸ ì¹˜ë£Œë¥¼ ê¼­ í•´ì•¼ í•˜ë‚˜ìš”?',
        'ì„±ì¡°ìˆ™ì¦ê²€ì‚¬': 'ì„±ì¡°ìˆ™ì¦ ì§„ë‹¨ì„ ìœ„í•´ ì™œ ì´ë ‡ê²Œ ë§ì€ ê²€ì‚¬ë¥¼ í•´ì•¼ í•˜ë‚˜ìš”?',
        
        // ì„±ì¥í˜¸ë¥´ëª¬ ê´€ë ¨
        'ì„±ì¥í˜¸ë¥´ëª¬ì–¸ì œ': 'ì„±ì¥í˜¸ë¥´ëª¬ì€ ì–¸ì œ ê°€ì¥ ë§ì´ ë‚˜ì˜¤ë‚˜ìš”?',
        'í˜¸ë¥´ëª¬ì–¸ì œ': 'ì„±ì¥í˜¸ë¥´ëª¬ì€ ì–¸ì œ ê°€ì¥ ë§ì´ ë‚˜ì˜¤ë‚˜ìš”?',
        'ì–¸ì œë‚˜ì˜¤': 'ì„±ì¥í˜¸ë¥´ëª¬ì€ ì–¸ì œ ê°€ì¥ ë§ì´ ë‚˜ì˜¤ë‚˜ìš”?',
        'ëª‡ì‹œë‚˜ì˜¤': 'ì„±ì¥í˜¸ë¥´ëª¬ì€ ì–¸ì œ ê°€ì¥ ë§ì´ ë‚˜ì˜¤ë‚˜ìš”?',
        'ì„±ì¥í˜¸ë¥´ëª¬ì–´ë””': 'ì„±ì¥í˜¸ë¥´ëª¬ì€ ìš°ë¦¬ ëª¸ ì–´ë””ì—ì„œ ë§Œë“¤ì–´ì§€ë‚˜ìš”?',
        'ì–´ë””ì—ì„œë§Œë“¤': 'ì„±ì¥í˜¸ë¥´ëª¬ì€ ìš°ë¦¬ ëª¸ ì–´ë””ì—ì„œ ë§Œë“¤ì–´ì§€ë‚˜ìš”?',
        'ì„±ì¥í˜¸ë¥´ëª¬ì£¼ì‚¬': 'ì„±ì¥í˜¸ë¥´ëª¬ ì£¼ì‚¬, ë§¤ì¼ ë§ì•„ì•¼ í•˜ë‚˜ìš”?',
        'ì£¼ì‚¬íš¨ê³¼': 'ì„±ì¥í˜¸ë¥´ëª¬ ì¹˜ë£Œ, ì •ë§ íš¨ê³¼ê°€ ìˆë‚˜ìš”?',
        'ì„±ì¥í˜¸ë¥´ëª¬íš¨ê³¼': 'ì„±ì¥í˜¸ë¥´ëª¬ ì¹˜ë£Œ, ì •ë§ íš¨ê³¼ê°€ ìˆë‚˜ìš”?',
        'ë¶€ì‘ìš©': 'ì„±ì¥í˜¸ë¥´ëª¬ ì£¼ì‚¬ì˜ ë¶€ì‘ìš©ì€ ì—†ë‚˜ìš”?',
        
        // ì†Œì•„ë¹„ë§Œ ê´€ë ¨
        'ì‚´ì°œ': 'ìš°ë¦¬ ì•„ì´ê°€ ì†Œì•„ë¹„ë§Œì¸ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        'ì‚´ìª˜': 'ìš°ë¦¬ ì•„ì´ê°€ ì†Œì•„ë¹„ë§Œì¸ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        'ëš±ëš±': 'ìš°ë¦¬ ì•„ì´ê°€ ì†Œì•„ë¹„ë§Œì¸ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        'ì²´ì¤‘ì¦ê°€': 'ìš°ë¦¬ ì•„ì´ê°€ ì†Œì•„ë¹„ë§Œì¸ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        'ì‚´ë¹¼': 'ìš°ë¦¬ ì•„ì´ê°€ ì†Œì•„ë¹„ë§Œì¸ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        'ë‹¤ì´ì–´íŠ¸': 'ìš°ë¦¬ ì•„ì´ê°€ ì†Œì•„ë¹„ë§Œì¸ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        'ì²´ì¤‘ê´€ë¦¬': 'ìš°ë¦¬ ì•„ì´ê°€ ì†Œì•„ë¹„ë§Œì¸ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        'ë¹„ë§Œì§„ë‹¨': 'ìš°ë¦¬ ì•„ì´ê°€ ì†Œì•„ë¹„ë§Œì¸ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        'bmi': 'ìš°ë¦¬ ì•„ì´ê°€ ì†Œì•„ë¹„ë§Œì¸ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        
        // í‚¤ ê´€ë ¨
        'í‚¤ì‘': 'íŠ¹ë°œì„± ì €ì‹ ì¥ì´ë€ ë¬´ì—‡ì´ë©°, ì¹˜ë£Œê°€ í•„ìš”í•œê°€ìš”?',
        'í‚¤ê°€ì‘': 'íŠ¹ë°œì„± ì €ì‹ ì¥ì´ë€ ë¬´ì—‡ì´ë©°, ì¹˜ë£Œê°€ í•„ìš”í•œê°€ìš”?',
        'ì €ì‹ ì¥': 'íŠ¹ë°œì„± ì €ì‹ ì¥ì´ë€ ë¬´ì—‡ì´ë©°, ì¹˜ë£Œê°€ í•„ìš”í•œê°€ìš”?',
        'í‚¤ì•ˆí¼': 'íŠ¹ë°œì„± ì €ì‹ ì¥ì´ë€ ë¬´ì—‡ì´ë©°, ì¹˜ë£Œê°€ í•„ìš”í•œê°€ìš”?',
        'ì‘ì€í‚¤': 'íŠ¹ë°œì„± ì €ì‹ ì¥ì´ë€ ë¬´ì—‡ì´ë©°, ì¹˜ë£Œê°€ í•„ìš”í•œê°€ìš”?',
        '3ë°±ë¶„ìœ„': '3ë°±ë¶„ìœ„ ë¯¸ë§Œ ë˜ëŠ” ì—°ê°„ ì„±ì¥ ì†ë„ê°€ 4cm ë¯¸ë§Œì´ë©´ ì–´ë–¤ ê²€ì‚¬ë¥¼ ë°›ì•„ì•¼ í•˜ë‚˜ìš”?',
        
        // ê²€ì‚¬ ê´€ë ¨
        'ê²€ì‚¬ë°›': '3ë°±ë¶„ìœ„ ë¯¸ë§Œ ë˜ëŠ” ì—°ê°„ ì„±ì¥ ì†ë„ê°€ 4cm ë¯¸ë§Œì´ë©´ ì–´ë–¤ ê²€ì‚¬ë¥¼ ë°›ì•„ì•¼ í•˜ë‚˜ìš”?',
        'ë³‘ì›ê°€': '6ì‚´ ì•„ì´ê°€ 1ë…„ì— 4cmë„ ì•ˆ ìëëŠ”ë° ë³‘ì›ì— ê°€ì•¼ í•˜ë‚˜ìš”?',
        'ì–¸ì œê²€ì‚¬': '3ë°±ë¶„ìœ„ ë¯¸ë§Œ ë˜ëŠ” ì—°ê°„ ì„±ì¥ ì†ë„ê°€ 4cm ë¯¸ë§Œì´ë©´ ì–´ë–¤ ê²€ì‚¬ë¥¼ ë°›ì•„ì•¼ í•˜ë‚˜ìš”?',
        'ê²€ì‚¬ë¹„ìš©': 'ì„±ì¥ ê²€ì‚¬ ë¹„ìš©ì€ ì–¼ë§ˆë‚˜ ë“œë‚˜ìš”?',
        'ê³¨ì—°ë ¹': 'ê³¨ì—°ë ¹ ê²€ì‚¬ê°€ ë¶€ëª¨ í‚¤ ê³µì‹ë³´ë‹¤ ë” ì •í™•í•œê°€ìš”?',
        'ë¼ˆë‚˜ì´': 'ê³¨ì—°ë ¹ ê²€ì‚¬ê°€ ë¶€ëª¨ í‚¤ ê³µì‹ë³´ë‹¤ ë” ì •í™•í•œê°€ìš”?',
        
        // ìˆ˜ë©´ ê´€ë ¨
        'ëª‡ì‹œìì•¼': 'ì•„ì´ë¥¼ ëª‡ ì‹œì— ì¬ì›Œì•¼ ì„±ì¥ì— ì¢‹ì€ê°€ìš”?',
        'ì ': 'ì•„ì´ë¥¼ ëª‡ ì‹œì— ì¬ì›Œì•¼ ì„±ì¥ì— ì¢‹ì€ê°€ìš”?',
        'ìˆ˜ë©´ì‹œê°„': 'ì•„ì´ë¥¼ ëª‡ ì‹œì— ì¬ì›Œì•¼ ì„±ì¥ì— ì¢‹ì€ê°€ìš”?',
        'ëŠ¦ê²Œì': 'ì•„ì´ë¥¼ ëª‡ ì‹œì— ì¬ì›Œì•¼ ì„±ì¥ì— ì¢‹ì€ê°€ìš”?',
        
        // ì˜ì–‘ ê´€ë ¨
        'ë¹„íƒ€ë¯¼': 'ë¹„íƒ€ë¯¼ ë””ë¥¼ ê³¼ë‹¤ ë³µìš©í•˜ë©´ ì•ˆ ë˜ë‚˜ìš”?',
        'ì¹¼ìŠ˜': 'ì¹¼ìŠ˜ì œëŠ” ì–¸ì œë¶€í„° ë¨¹ì´ë©´ ì¢‹ì„ê¹Œìš”?',
        'ì•„ì—°': 'ì•„ì—° ê²°í• ì¦ìƒì€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?',
        'ì˜ì–‘ì œ': 'ì„±ì¥ê¸° ì•„ì´ì—ê²Œ ì–´ë–¤ ì˜ì–‘ì œë¥¼ ë¨¹ì—¬ì•¼ í•˜ë‚˜ìš”?',
        
        // ìš´ë™ ê´€ë ¨
        'ìš´ë™': 'í‚¤ í¬ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ìš´ë™ì€ ë¬´ì—‡ì¸ê°€ìš”?',
        'ìŠ¤íŠ¸ë ˆì¹­': 'í‚¤ í¬ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ìš´ë™ì€ ë¬´ì—‡ì¸ê°€ìš”?',
    };
    
    // 1ë‹¨ê³„: ì§ì ‘ ë§¤í•‘ í™•ì¸
    for (const [pattern, mappedQuestion] of Object.entries(questionMappings)) {
        if (cleanQuestion.includes(pattern)) {
            console.log('âœ“ ì§ì ‘ ë§¤í•‘:', pattern, 'â†’', mappedQuestion);
            const mappedResult = findExactMatch(mappedQuestion);
            if (mappedResult) {
                return mappedResult;
            }
        }
    }
    
    // 2ë‹¨ê³„: ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ê²€ìƒ‰
    const categoryKeywords = {
        'ì„±ì¥í˜¸ë¥´ëª¬_ê¸°ì´ˆ': ['ì„±ì¥í˜¸ë¥´ëª¬ì€', 'ì„±ì¥í˜¸ë¥´ëª¬ì´', 'ì–´ë””ì—ì„œ', 'igf', 'ë‡Œí•˜ìˆ˜ì²´', 'ì‹œìƒí•˜ë¶€', 'ë¶„ë¹„'],
        'ì„±ì¥í˜¸ë¥´ëª¬_ì¹˜ë£Œ': ['ì„±ì¥í˜¸ë¥´ëª¬ì¹˜ë£Œ', 'ì„±ì¥í˜¸ë¥´ëª¬ì£¼ì‚¬', 'ì£¼ì‚¬', 'ì¹˜ë£Œê¸°ê°„', 'ì¹˜ë£Œíš¨ê³¼'],
        'ì„±ì¡°ìˆ™ì¦': ['ì„±ì¡°ìˆ™ì¦', 'ì‚¬ì¶˜ê¸°', '2ì°¨ì„±ì§•', 'ê°€ìŠ´', 'ì¡°ê¸°ìœ ë°©'],
        'ì†Œì•„ë¹„ë§Œ': ['ì†Œì•„ë¹„ë§Œ', 'bmi', 'ë¹„ë§Œ', 'ì²´ì§ˆëŸ‰ì§€ìˆ˜', 'ì‚´', 'ì²´ì¤‘', 'ëš±ëš±'],
        'ì €ì‹ ì¥': ['ì €ì‹ ì¥', 'í‚¤ê°€ì‘', '3ë°±ë¶„ìœ„', 'í‚¤ì‘'],
        'ì˜ì–‘': ['ë¹„íƒ€ë¯¼', 'ì˜ì–‘', 'ì¹¼ìŠ˜', 'ì•„ì—°', 'ì² ë¶„', 'ë‹¨ë°±ì§ˆ'],
        'ì‹ìŠµê´€': ['ì‹ë‹¨', 'ê°„ì‹', 'ìŒì‹', 'ë¨¹', 'ì‹ì‚¬'],
        'ìš´ë™': ['ìš´ë™', 'ìŠ¤íŠ¸ë ˆì¹­', 'ì²´ìœ¡'],
        'ìˆ˜ë©´': ['ìˆ˜ë©´', 'ì ', 'ëŠ¦ê²Œì', 'ì¬ì›Œ', 'ìì•¼'],
        'ê²€ì‚¬': ['ê²€ì‚¬', 'ë¹„ìš©', 'ë³´í—˜', 'ê³¨ì—°ë ¹', 'ë¼ˆë‚˜ì´'],
        'ì¼ë°˜ì„±ì¥': ['ì„±ì¥', 'í‚¤', 'í¬', 'ìë¼', 'ì„±ì¥ì†ë„', '1ë…„', 'ì„¼í‹°', 'cm'],
    };
    
    let userCategory = null;
    let maxScore = 0;
    for (const [category, keywords] of Object.entries(categoryKeywords)) {
        let score = 0;
        for (const keyword of keywords) {
            if (lowerQuestion.includes(keyword)) {
                score += 1;
            }
        }
        if (score > maxScore) {
            maxScore = score;
            userCategory = category;
        }
    }
    
    console.log('íŒŒì•…ëœ ì¹´í…Œê³ ë¦¬:', userCategory, '(ì ìˆ˜:', maxScore + ')');
    
    let bestMatch = null;
    let bestScore = 0;
    
    for (const record of allRecords) {
        const dbQuestion = (record.ì§ˆë¬¸ || '').toLowerCase();
        const cleanDbQuestion = dbQuestion.replace(/\s/g, '');
        const keywords = (record.í‚¤ì›Œë“œ || '').toLowerCase();
        const tags = (record.íƒœê·¸ || '').toLowerCase();
        
        // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
        if (userCategory && maxScore >= 2) {
            let recordInCategory = false;
            const categoryKws = categoryKeywords[userCategory] || [];
            for (const kw of categoryKws) {
                if (dbQuestion.includes(kw) || keywords.includes(kw)) {
                    recordInCategory = true;
                    break;
                }
            }
            if (!recordInCategory) {
                continue;
            }
        }
        
        let score = 0;
        
        if (cleanDbQuestion === cleanQuestion) {
            score = 1000;
        } else if (cleanDbQuestion.includes(cleanQuestion)) {
            score = 500;
        } else if (cleanQuestion.includes(cleanDbQuestion)) {
            score = 400;
        } else {
            const mainKeywords = ['ì„±ì¡°ìˆ™ì¦', 'ì„±ì¥í˜¸ë¥´ëª¬', 'ì†Œì•„ë¹„ë§Œ', 'í‚¤', 'ë¹„ë§Œ', 'ì„±ì¥', 'ì €ì‹ ì¥'];
            for (const mainKey of mainKeywords) {
                if (lowerQuestion.includes(mainKey) && dbQuestion.includes(mainKey)) {
                    score += 200;
                }
            }
            
            const keywordList = keywords.split(',').map(k => k.trim());
            for (const keyword of keywordList) {
                if (keyword && keyword.length > 1) {
                    if (lowerQuestion.includes(keyword)) {
                        score += 50;
                    }
                }
            }
            
            const tagList = tags.split('#').map(t => t.trim()).filter(t => t);
            for (const tag of tagList) {
                if (tag && lowerQuestion.includes(tag)) {
                    score += 30;
                }
            }
        }
        
        if (score > bestScore) {
            bestScore = score;
            bestMatch = { 
                answer: record.ë‹µë³€ || 'ë‹µë³€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.', 
                videoLink: record.ì˜ìƒë§í¬,
                question: record.ì§ˆë¬¸
            };
        }
    }
    
    console.log('ê²€ìƒ‰ì–´:', question, '/ ì¹´í…Œê³ ë¦¬:', userCategory, '/ ìµœê³ ì ìˆ˜:', bestScore, '/ ë§¤ì¹­:', bestMatch?.question);
    return bestScore >= 50 ? bestMatch : null;
}

function addMessage(text, type, videoLink = null) {
    const messages = document.getElementById('messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}-message`;
    const bubble = document.createElement('div');
    bubble.className = 'message-bubble';
    bubble.textContent = text;
    messageDiv.appendChild(bubble);
    if (videoLink && type === 'bot' && videoLink !== 'nan') {
        const videoBtn = document.createElement('a');
        videoBtn.className = 'video-button';
        videoBtn.href = videoLink;
        videoBtn.target = '_blank';
        videoBtn.innerHTML = 'ğŸ“º ì˜ìƒìœ¼ë¡œ ë³´ê¸°';
        bubble.appendChild(document.createElement('br'));
        bubble.appendChild(videoBtn);
    }
    messages.appendChild(messageDiv);
    messages.scrollTop = messages.scrollHeight;
}
</script>
</body>
</html>
